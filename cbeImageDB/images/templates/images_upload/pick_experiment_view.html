{% extends 'images/base.html' %}
{% block content %}
{% load static %}

<h2>What Can JavaScript Do?</h2>

<form action="result.php" method="post" id="demoForm" class="demoForm">
	<select name="names" size="3" autofocus>
	  {% for name in names %}
	  	<option value="{{ forloop.counter }}"> {{ name }} </option>
	  {% endfor %}
	</select>
    
</form>

<p id="test-metadata"> </p>

<h2 id="exp_name"> </h2>

<ul id="metadata">
	<li><b>Name</b> <div id="exp-name" display="inline"> </div></li>
</ul>


<p> {{ experiments }} </p>
<p id="demo">JavaScript can change HTML content.</p>

<button type="button" onclick='document.getElementById("demo").innerHTML = "Hello JavaScript!"'>Click Me!</button>


<script type="text/javascript">
// make a list of all the experiments
var names = [{% for x in names %}'{{ x|safe|escapejs }}',{% endfor %}];
var json_string = unescape('{{ experiments|safe|escapejs}}');
var json_data = JSON.parse(json_string);
// anonymous function assigned to onchange event of controlling select list
document.forms['demoForm'].elements['names'].onchange = function() {
    var form = document.forms['demoForm'];
    // this changes the stuff on load, but it doesn't change it dynamically
	var sel = form.elements['names'];
	document.getElementById("test-metadata").innerHTML = sel.value;
	//document.getElementById("exp_name").innerHTML = json_string;//names[sel.value-1];
	
	var exp = json_data[String(sel.value-1)];
	//document.getElementById("exp-name").innerHTML = exp['name'];
	//document.getElementById("exp-").innerHTML = exp[];
	// create document fragment to add list to
	var fragment = document.createDocumentFragment();
	// for each key, add it to the document
	var keys = Object.keys(exp);
	//document.getElementById("exp-name").innerHTML = "cat";//typeof exp[0];
	
	var ul = document.getElementById("metadata")
	ul.innerHTML = "";  // clear what is already there
	var li;
	var b;
	for (var i=0; i < keys.length; i++) {
		// 
		li = document.createElement('li');
		b = document.createElement('b');
		b.textContent = keys[i];
		li.appendChild(b);
		li.textContent = exp[keys[i]];
		fragment.appendChild(li);
	}
	ul.appendChild(fragment);
}; 

// Not sure if this will be needed

window.onload = function() {
    var form = document.forms['demoForm'];
    
    // reference to controlling select list
    var sel = form.elements['names'];
    sel.selectedIndex = 0;
    
}; 
	

</script>


{% endblock %}

{% block footer %}

{% endblock %}


